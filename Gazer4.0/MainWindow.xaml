<Window x:Class="ImageViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ImageViewer"
        Title="{Binding RelativeSource={RelativeSource Self}, Path=WindowTitle}" Height="600" Width="800"
        WindowStyle="SingleBorderWindow"
        Background="Transparent" 
        ResizeMode="NoResize"
        
        Activated="Window_Activated"
        Deactivated="Window_Deactivated"
        AllowDrop="True" Drop="Window_Drop" KeyDown="Window_KeyDown">
    <Grid>
        <!-- 主画布区域 -->
        <Border ClipToBounds="True">
            <Canvas x:Name="canvas" Background="#F0F0F0"
                    MouseRightButtonDown="Canvas_MouseRightButtonDown"
                    MouseRightButtonUp="Canvas_MouseRightButtonUp"
                    MouseMove="Canvas_MouseMove"
                    MouseWheel="Canvas_MouseWheel">
                <Image x:Name="imgDisplay" Stretch="Uniform" RenderOptions.BitmapScalingMode="HighQuality" MouseDown="OnMouseClickImage"/>
            </Canvas>
        </Border>
        
        <!-- 提示文字 - 使用x:Name以便代码中设置多语言支持 -->
        <TextBlock x:Name="hintText" VerticalAlignment="Center" HorizontalAlignment="Center" 
                   TextAlignment="Center" Foreground="Gray" FontSize="16"/>

        <!-- 设置面板 - 重新设计 -->
        <Border x:Name="settingsPanel" Visibility="Collapsed" 
                Background="#EEEEEE" BorderBrush="#E0E0E0" BorderThickness="1"
                Width="320" HorizontalAlignment="Right"
                Margin="0">
            <Border.Effect>
                <DropShadowEffect ShadowDepth="3" BlurRadius="10" Opacity="0.2" />
            </Border.Effect>
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- 标题栏 -->
                <Border Grid.Row="0" Background="#F5F5F5" Padding="15,12">
                    <Grid>
                        <TextBlock x:Name="settingsPanelTitle" Text="設定パネル" FontWeight="SemiBold" FontSize="18" VerticalAlignment="Center"/>
                        <TextBlock x:Name="settingsPanelCloseHint" Text="Tabを押して閉じる" FontSize="12" Foreground="#666666" 
                                   HorizontalAlignment="Right" VerticalAlignment="Center"/>
                    </Grid>
                </Border>
                
                <!-- 设置内容区域 -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="15,10">
                        
                        <!-- 通用设置 -->
                        <Border Background="#F8F8F8" CornerRadius="5" Padding="12" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock x:Name="generalSettingsTitle" Text="一般的な設定" FontWeight="Medium" FontSize="14" Margin="0,0,0,8"/>
                                <CheckBox x:Name="chkShowNotifications" Content="通知を表示" />
                                <CheckBox x:Name="chkAutoSizeWindow" Content="画像サイズのウィンドウ" 
                                          IsChecked="True" Margin="0,6,0,0" 
                                          Checked="ChkAutoSizeWindow_Changed" 
                                          Unchecked="ChkAutoSizeWindow_Changed"/>
                                <CheckBox x:Name="chkAutoBorderless" Content="自動でボーダーを消す" 
                                          IsChecked="True" Margin="0,6,0,0" 
                                          Checked="ChkAutoBorderless_Changed" 
                                          Unchecked="ChkAutoBorderless_Changed"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- 播放控制 -->
                        <Border Background="#F8F8F8" CornerRadius="5" Padding="12" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock x:Name="playbackControlTitle" Text="再生コントロール" FontWeight="Medium" FontSize="14" Margin="0,0,0,8"/>
                                
                                <CheckBox x:Name="chkAutoPlay" Content="自動再生（space）" 
                                          Checked="ChkAutoPlay_Changed" 
                                          Unchecked="ChkAutoPlay_Changed" />
                                
                                <CheckBox x:Name="chkRandomPlayback" Content="シャッフル再生" 
                                          Checked="ChkRandomPlayback_Changed" 
                                          Unchecked="ChkRandomPlayback_Changed"
                                          Margin="0,6,0,0" />
                                
                                <!-- 播放间隔 -->
                                <Grid Margin="0,10,0,0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="45"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" x:Name="playbackIntervalLabel" Text="再生間隔" 
                                               FontSize="12" Margin="0,0,0,4"/>
                                    <TextBlock x:Name="lblAutoPlayInterval" Grid.Row="0" Grid.Column="1" 
                                               Text="3.0s" FontSize="12" HorizontalAlignment="Right"/>
                                    <Slider x:Name="sliderAutoPlayInterval" Grid.Row="1" Grid.ColumnSpan="2"
                                            Minimum="0.5" Maximum="10" Value="3"
                                            ValueChanged="SliderAutoPlayInterval_ValueChanged" />
                                </Grid>
                                
                                <!-- 间隔随机度 -->
                                <Grid Margin="0,8,0,0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="45"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" x:Name="randomnessLabel" Text="間隔のランダム度" 
                                               FontSize="12" Margin="0,0,0,4"/>
                                    <TextBlock x:Name="lblAutoPlayRandomness" Grid.Row="0" Grid.Column="1" 
                                               Text="0%" FontSize="12" HorizontalAlignment="Right"/>
                                    <Slider x:Name="sliderAutoPlayRandomness" Grid.Row="1" Grid.ColumnSpan="2"
                                            Minimum="0" Maximum="100" Value="0"
                                            ValueChanged="SliderAutoPlayRandomness_ValueChanged" />
                                </Grid>
                                <Button Name="btnSavePlaylist" Content="プレイリスト保存" Padding="5" Margin="5" Click="BtnSavePlaylist_Click"/>
                                <Button Name="btnLoadPlaylist" Content="プレイリスト読み込み" Padding="5" Margin="5" Click="BtnLoadPlaylist_Click"/>
                                <!-- 播放列表设置 -->
                                <CheckBox Name="chkUseAbsolutePaths" Content="絶対パスで保存" 
                                          Margin="5" FontSize="12" IsChecked="False"
                                          Visibility="Collapsed"
                                />
                                <CheckBox Name="chkRegisterFileType" Content=".gzpl を関連付け" 
                                          Margin="5" FontSize="12" 
                                          Visibility="Collapsed"
                                          Checked="ChkRegisterFileType_Changed" Unchecked="ChkRegisterFileType_Changed"/>
                                <TextBlock Name="lblPlaylistInfo" Margin="5" Text="現在プレイリストモードではありません" 
                                           Visibility="Collapsed"
                                           FontSize="12" Foreground="Gray"/>
                                
                            </StackPanel>
                            
                               
                            
                        </Border>
                        
                        <!-- 视觉效果 -->
                        <Border Background="#F8F8F8" CornerRadius="5" Padding="12" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Name="VisualSetting" Text="視覚効果" FontWeight="Medium" FontSize="14" Margin="0,0,0,8"/>
                                
                                <!-- 背景颜色 -->
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <Rectangle x:Name="colorPreview" Grid.Column="0" 
                                               Width="40" Height="40" 
                                               RadiusX="3" RadiusY="3"
                                               Visibility="Collapsed"
                                               Stroke="#DDDDDD" StrokeThickness="1" 
                                               Margin="0,0,12,0"/>
                                    
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <Button x:Name="btnSelectColor" Content="背景色選択" 
                                                Visibility="Collapsed"
                                                Click="BtnSelectColor_Click" Height="28"/>
                                        <Button x:Name="btnResetColor" Content="デフォルトに戻す" 
                                                Click="BtnResetColor_Click" Height="24" 
                                                Visibility="Collapsed"
                                                Margin="0,4,0,0" FontSize="11"/>
                                    </StackPanel>
                                   
                                </Grid>
                                
                                <!-- 快速颜色选择 -->
                                <WrapPanel x:Name="colorPalette" Margin="0,0,0,10">
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="2" Width="24" Height="24" 
                                            Background="#E2E2E2" MouseDown="ColorSwatch_MouseDown" Tag="#E2E2E2" 
                                            CornerRadius="2" Cursor="Hand"/>
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="2" Width="24" Height="24" 
                                            Background="#18201E" MouseDown="ColorSwatch_MouseDown" Tag="#18201E" 
                                            CornerRadius="2" Cursor="Hand"/>
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="2" Width="24" Height="24" 
                                            Background="#000000" MouseDown="ColorSwatch_MouseDown" Tag="#000000" 
                                            CornerRadius="2" Cursor="Hand"/>
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="2" Width="24" Height="24" 
                                            Background="#F2151822" MouseDown="ColorSwatch_MouseDown" Tag="#F2151822" 
                                            CornerRadius="2" Cursor="Hand"/>
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="2" Width="24" Height="24" 
                                            Background="#192016" MouseDown="ColorSwatch_MouseDown" Tag="#192016" 
                                            CornerRadius="2" Cursor="Hand"/>
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="2" Width="24" Height="24" 
                                            Background="#211B24" MouseDown="ColorSwatch_MouseDown" Tag="#211B24" 
                                            CornerRadius="2" Cursor="Hand"/>
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="2" Width="24" Height="24" 
                                            Background="#EC191515" MouseDown="ColorSwatch_MouseDown" Tag="#EC191515" 
                                            CornerRadius="2" Cursor="Hand"/>
                                    <Border BorderBrush="#CCCCCC" BorderThickness="1" Margin="2" Width="24" Height="24" 
                                            Background="#C631121F" MouseDown="ColorSwatch_MouseDown" Tag="#C631121F" 
                                            CornerRadius="2" Cursor="Hand"/>
                                </WrapPanel>
                                
                                <!-- RGB 滑块 (折叠) -->
                                <Expander Visibility="Collapsed" Header="高度な色彩設定" Margin="0,0,0,10">
                                    <Grid Margin="0,8,0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="20"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="40"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- 红色 -->
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="赤" VerticalAlignment="Center"/>
                                        <Slider x:Name="sliderRed" Grid.Row="0" Grid.Column="1" 
                                                Minimum="0" Maximum="255" Value="240" Margin="5,2"
                                                ValueChanged="ColorSlider_ValueChanged"/>
                                        <TextBlock Grid.Row="0" Grid.Column="2" 
                                                   Text="{Binding Value, ElementName=sliderRed, StringFormat='{}{0:F0}'}" 
                                                   VerticalAlignment="Center" HorizontalAlignment="Right"/>
                                        
                                        <!-- 绿色 -->
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="緑" VerticalAlignment="Center"/>
                                        <Slider x:Name="sliderGreen" Grid.Row="1" Grid.Column="1" 
                                                Minimum="0" Maximum="255" Value="240" Margin="5,2"
                                                ValueChanged="ColorSlider_ValueChanged"/>
                                        <TextBlock Grid.Row="1" Grid.Column="2" 
                                                   Text="{Binding Value, ElementName=sliderGreen, StringFormat='{}{0:F0}'}" 
                                                   VerticalAlignment="Center" HorizontalAlignment="Right"/>
                                        
                                        <!-- 蓝色 -->
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="青" VerticalAlignment="Center"/>
                                        <Slider x:Name="sliderBlue" Grid.Row="2" Grid.Column="1" 
                                                Minimum="0" Maximum="255" Value="240" Margin="5,2"
                                                ValueChanged="ColorSlider_ValueChanged"/>
                                        <TextBlock Grid.Row="2" Grid.Column="2" 
                                                   Text="{Binding Value, ElementName=sliderBlue, StringFormat='{}{0:F0}'}" 
                                                   VerticalAlignment="Center" HorizontalAlignment="Right"/>
                                    </Grid>
                                </Expander>
                                <!-- 在设置面板中添加播放列表管理区域 -->
                                
                            </StackPanel>
                        </Border>
                        
                        <!-- 抖动效果 -->
                        <Border Background="#F8F8F8" CornerRadius="5" Padding="12" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Name="ShakeSettings"  Text="揺れ制御" FontWeight="Medium" FontSize="14" Margin="0,0,0,8"/>
                                
                                <!-- 相机抖动 -->
                                <CheckBox x:Name="chkEnableShake" Content="一般的な揺れ" IsChecked="True" 
                                          Checked="ChkEnableShake_Changed" Unchecked="ChkEnableShake_Changed"/>
                                
                                <Grid Margin="0,8,0,0" IsEnabled="{Binding IsChecked, ElementName=chkEnableShake}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="45"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- 抖动幅度 -->
                                    <TextBlock Grid.Row="0" Grid.Column="0" Name="ShakeStrength" Text="強度" FontSize="12"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" 
                                               Text="{Binding Value, ElementName=sliderShakeAmount, StringFormat='{}{0:F1}'}" 
                                               FontSize="12" HorizontalAlignment="Right"/>
                                    <Slider x:Name="sliderShakeAmount" Grid.Row="1" Grid.ColumnSpan="2"
                                            Minimum="0" Maximum="400" Value="20" 
                                            ValueChanged="ShakeSlider_ValueChanged" Margin="0,2,0,8"/>
                                    
                                    <!-- 抖动频率 -->
                                    <TextBlock Grid.Row="2" Grid.Column="0"  Name="ShakeSpeed"  Text="速さ" FontSize="12"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" 
                                               Text="{Binding Value, ElementName=sliderShakeFrequency, StringFormat='{}{0:F1}'}" 
                                               FontSize="12" HorizontalAlignment="Right"/>
                                    <Slider x:Name="sliderShakeFrequency" Grid.Row="3" Grid.ColumnSpan="2"
                                            Minimum="0.1" Maximum="10" Value="1.5" 
                                            ValueChanged="ShakeSlider_ValueChanged" Margin="0,2,0,0"/>
                                </Grid>
                                
                                <!-- 脉冲抖动 -->
                                <CheckBox x:Name="chkEnablePulse" Content="パルスの揺れ" IsChecked="False" 
                                          Checked="ChkEnablePulse_Changed" Unchecked="ChkEnablePulse_Changed"
                                          Margin="0,12,0,0"/>
                                
                                <Grid Margin="0,8,0,0" IsEnabled="{Binding IsChecked, ElementName=chkEnablePulse}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="45"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- 脉冲间隔 -->
                                    <TextBlock Grid.Row="0" Grid.Column="0"  Name="ImpulseInterval" Text="パルス間隔" FontSize="12"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" 
                                               Text="{Binding Value, ElementName=sliderPulseInterval, StringFormat='{}{0:F2}s'}" 
                                               FontSize="12" HorizontalAlignment="Right"/>
                                    <Slider x:Name="sliderPulseInterval" Grid.Row="1" Grid.ColumnSpan="2"
                                            Minimum="0.1" Maximum="2.0" Value="0.5" 
                                            ValueChanged="PulseSlider_ValueChanged" Margin="0,2,0,8"/>
                                    
                                    <!-- 间隔随机偏移 -->
                                    <TextBlock Grid.Row="2" Grid.Column="0"  Name="ImpulseRandomness"  Text="間隔のランダムオフセット" FontSize="12"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" 
                                               Text="{Binding Value, ElementName=sliderPulseRandomness, StringFormat='{}{0:F0}%'}" 
                                               FontSize="12" HorizontalAlignment="Right"/>
                                    <Slider x:Name="sliderPulseRandomness" Grid.Row="3" Grid.ColumnSpan="2"
                                            Minimum="0" Maximum="100" Value="30" 
                                            ValueChanged="PulseSlider_ValueChanged" Margin="0,2,0,8"/>
                                    
                                    <!-- 脉冲衰减速度 -->
                                    <TextBlock Grid.Row="4" Grid.Column="0"  Name="ImpulseDamping"  Text="パルス減衰" FontSize="12"/>
                                    <TextBlock Grid.Row="4" Grid.Column="1" 
                                               Text="{Binding Value, ElementName=sliderPulseDamping, StringFormat='{}{0:F1}'}" 
                                               FontSize="12" HorizontalAlignment="Right"/>
                                    <Slider x:Name="sliderPulseDamping" Grid.Row="5" Grid.ColumnSpan="2"
                                            Minimum="1" Maximum="20" Value="10" 
                                            ValueChanged="PulseSlider_ValueChanged" Margin="0,2,0,8"/>
                                    
                                    <!-- 脉冲强度X -->
                                    <TextBlock Grid.Row="6" Grid.Column="0"  Name="ImpulseHStrength"  Text="横方向強度" FontSize="12"/>
                                    <TextBlock Grid.Row="6" Grid.Column="1" 
                                               Text="{Binding Value, ElementName=sliderPulsePowerX, StringFormat='{}{0:F0}'}" 
                                               FontSize="12" HorizontalAlignment="Right"/>
                                    <Slider x:Name="sliderPulsePowerX" Grid.Row="7" Grid.ColumnSpan="2"
                                            Minimum="0" Maximum="12000" Value="100" 
                                            ValueChanged="PulseSlider_ValueChanged" Margin="0,2,0,8"/>
                                    
                                    <!-- 脉冲强度Y -->
                                    <TextBlock Grid.Row="8" Grid.Column="0"  Name="ImpulseVStrength" Text="縦方向強度" FontSize="12"/>
                                    <TextBlock Grid.Row="8" Grid.Column="1" 
                                               Text="{Binding Value, ElementName=sliderPulsePowerY, StringFormat='{}{0:F0}'}" 
                                               FontSize="12" HorizontalAlignment="Right"/>
                                    <Slider x:Name="sliderPulsePowerY" Grid.Row="9" Grid.ColumnSpan="2"
                                            Minimum="0" Maximum="12000" Value="100" 
                                            ValueChanged="PulseSlider_ValueChanged" Margin="0,2,0,8"/>
                                    
                                    <Button x:Name="btnTriggerPulse" Grid.Row="10" Grid.ColumnSpan="2"
                                            Content="単回トリガー" Margin="0,4,0,0" Height="28" Visibility="Collapsed"
                                            Click="BtnTriggerPulse_Click"/>
                                    
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                    </StackPanel>
                </ScrollViewer>
              
                <!-- 预设控制区域 -->
                <Border Grid.Row="2" Background="#F5F5F5" Padding="15,12">
                    <StackPanel>
                        <TextBlock Name="presetHint" Visibility="Collapsed" Text="保存をクリックし、数字1-4で切り替えます" 
                                   FontSize="11" Foreground="#666666" TextWrapping="Wrap" Margin="0,0,0,10"/>
                        <UniformGrid Columns="4" Margin="0,0,0,8">
                            <Button x:Name="btnPreset1" Content="1" Height="36" Margin="3" 
                                    Click="BtnPreset_Click" Tag="0" FontSize="16"/>
                            <Button x:Name="btnPreset2" Content="2" Height="36" Margin="3" 
                                    Click="BtnPreset_Click" Tag="1" FontSize="16"/>
                            <Button x:Name="btnPreset3" Content="3" Height="36" Margin="3" 
                                    Click="BtnPreset_Click" Tag="2" FontSize="16"/>
                            <Button x:Name="btnPreset4" Content="4" Height="36" Margin="3" 
                                    Click="BtnPreset_Click" Tag="3" FontSize="16"/>
                        </UniformGrid>
                        <Button x:Name="btnApplyPreset" Content="プリセットを適用する" 
                                Click="BtnApplyPreset_Click" Visibility="Collapsed" Height="28"/>
                        <TextBlock x:Name="lblLanguage" Grid.Column="0" Text="声語" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <!-- 触发按钮 -->
                        <ComboBox x:Name="cmbLanguage" Grid.Column="1" SelectionChanged="CmbLanguage_SelectionChanged">
                            <ComboBoxItem x:Name="cmbItemChinese" Content="中文"/>
                            <ComboBoxItem x:Name="cmbItemJapanese" Content="日本語"/>
                            <ComboBoxItem x:Name="cmbItemEnglish" Content="English"/>
                        </ComboBox>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
